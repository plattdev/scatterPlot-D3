<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D3 Scatter Plot</title>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      /* text elements, includes the tick marks, the class tick is generated by d3 */
      .tick text {
        font-size: 24px;
      }
    </style>

    <!-- load D3.js library, it is using the D3 global without a bundler -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body></body>
  <script>

    //******   TWEAKABLE PARAMETERS SECTION - EDIT TO CUSTOMIZE YOUR SCATTER PLOT  ******//

    //IMPORTING CSV FUNCTION FROM D3 - import other D3 modules as needed
    const { csv, select, scaleLinear } = d3; // Destructure csv function from d3, originally: const csv = d3.csv; and const select = d3.select;

    // Fetch CSV data source URL
    const csvUrl = [
      "https://gist.githubusercontent.com/",
      "curran/", // Gist user (change for your own data)
      "a08a1080b88344b0c8a7/", // Gist ID
      "raw/0e7a9b0a5d22642a06d3d5b9bcbad9890c8ee534/", // Commit hash
      "iris.csv", // CSV file name
    ].join("");

    // Data parsing function to parse string into numbers - Edit this to match your CSV column names and types
    const parseRow = (d) => {
      d.sepal_length = +d.sepal_length;
      d.sepal_width = +d.sepal_width;
      d.petal_length = +d.petal_length;
      d.petal_width = +d.petal_width;
      return d;
    };

    // Accessor functions for X and Y axes (determines which properties for each datapoint (d) to plot for X and Y)
    const xValue = (d) => d.petal_length; // X axis: petal_length
    const yValue = (d) => d.sepal_length; // Y axis: sepal_length

    //DESIGN PART
    // Margin convention PRIOR to the axes creation and used in scales in the range() - Adjust these for spacing and layout
    const margin = {
      top: 80,
      right: 150,
      bottom: 100,
      left: 100,
    };

    // SVG canvas size - window size by default
    const width = window.innerWidth;
    const height = window.innerHeight;

    // Circle radius
    const radius = 5;

    //Circle color and opacity
    const circleColor = "teal";
    const circleOpacity = 0.7;

    //Axis labels
    const xAxisLabel = "Petal Length"; // Change for your X axis
    const yAxisLabel = "Sepal Length"; // Change for your Y axis
    const axisLabelFontSize = "24px"; // Change font size if needed

    //title
    const title = "Iris Flower";

    // ***** BOILERPLATE SECTION - DO NOT EDIT ***** //

    // USING THE CSV FUNCTION (BUILT INTO D3) TO IMPORT DATA - parses the data as a promise asynchronously (code will wait for the data to be loaded). It creates one object per row. However this returns strings for all data types by default, then parse it into numbers (see above function called parseRow).
    csv(csvUrl).then((data) => {
      console.log(data); // Remove or keep for debugging
    });

    // CREATE SVG ELEMENT
    const svg = select("body") //no need to write d3.select here as we explained in the import above
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Main function: Build scatter plot
    const main = async () => {
      const data = await csv(csvUrl, parseRow); //await makes the code wait until the data is loaded

      // SCALE to figure out where to place the circles, to convert data values into pixel values
      const xScale = scaleLinear() // gives back an object that has methods on it
        .domain([0, d3.max(data, xValue)]) // go from 0 to the max of the data (x axes start at 0) - ***TWEAKABLE***
        .range([margin.left, width - margin.right]); // pixel values from left to right, within margins

      const yScale = scaleLinear()
        .domain(d3.extent(data, yValue)) // y axes go from min to max of data (full extent of where the circles can go - ***TWEAKABLE***
        .range([height - margin.bottom, margin.top]); // pixel values from bottom to top, within margins

      //CREATE MARKS or CIRCLES POSITIONS for the scatter plot - mark data to circle positions. Map is a built-in array function that creates a new array by calling a function on each element of the original array called data here
      const marks = data.map((d) => ({
        x: xScale(xValue(d)),
        y: yScale(yValue(d)),
        titlePoints: `( ${xValue(d)}, ${yValue(d)} )`, // TOOLTIP text to show on hover
      }));

      //DRAW CIRCLES
      svg
        .selectAll("circle")
        .data(marks)
        .join("circle")
        .attr("cx", (d) => d.x) //center x position of the circle
        .attr("cy", (d) => d.y)
        .attr("r", radius)
        .attr("fill", circleColor)
        .attr("opacity", circleOpacity)
        .append("title") // A tooltip! x,y values on hover (a tooltip = small box that appears when you hover over a shape (here a circle). This is done by adding a <title> element inside each SVG shape
        .text((d) => d.titlePoints);

      //CREATE AXES
      //g element is a container used to group other SVG elements, is needed for grouping the axis elements
      //the call function calls a function on a selection, in this case we are calling the axisBottom function on the svg element
      svg
        .append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale)); // create left axis using the yScale

      svg
        .append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale));

      // X axis label
      svg
        .append("text")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom + 70)
        .attr("text-anchor", "middle")
        .attr("font-size", axisLabelFontSize)
        .text(xAxisLabel);

      // Y axis label
      svg
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", 35)
        .attr("text-anchor", "middle")
        .attr("font-size", axisLabelFontSize)
        .text(yAxisLabel);

      // Title
      svg
        .append("text")
        .attr("x", width / 2)
        .attr("y", margin.top - 40)
        .attr("text-anchor", "middle")
        .attr("font-size", "32px")
        .attr("font-weight", "bold")
        .text(title);
    };

    // Call the main function to render the scatter plot
    main();
  </script>
</html>
